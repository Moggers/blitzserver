#[cfg(test)]
mod tests {
    use crate::util::calculate_crc;
    #[test]
    fn test_crc_len1() {
        assert_eq!(calculate_crc(&vec![0x0]), 0x100);
        assert_eq!(calculate_crc(&vec![0x1]), 0x201);
        assert_eq!(calculate_crc(&vec![0x2]), 0x302);
        assert_eq!(calculate_crc(&vec![0x3]), 0x403);
    }
    #[test]
    fn test_crc_len2() {
        assert_eq!(calculate_crc(&vec![0x0, 0x0]), 0x4200);
        assert_eq!(calculate_crc(&vec![0x1, 0x1]), 0x8441);
        assert_eq!(calculate_crc(&vec![0x4, 0x1]), 0x14501);
    }
    #[test]
    fn test_crc_len3() {
        assert_eq!(calculate_crc(&vec![0x0, 0x0, 0x0]), 0x108300);
    }
    #[test]
    fn test_crc_len5() {
        assert_eq!(calculate_crc(&vec![0x1, 0x2, 0x3, 0x4, 0x5]), 0x19CD4F07);
    }
}

pub fn calculate_crc(data: &[u8]) -> u32 {
    let mut register: u32 = 0;
    let mut index: usize = 0;
    while index != data.len() {
        register = register.rotate_left(6);
        let dat: u32 = data[index] as u32;
        index += 1;
        register = (std::num::Wrapping(register ^ dat)
            + std::num::Wrapping((dat + 1) * (index as u32) << 8))
        .0;
    }
    return register;
}
pub fn calculate_trn_cc(data: &[u8]) -> u16 {
    if data.len() == 0 {
        return 0;
    }
    let mut dx: u32 = 0;
    let mut result = 0;
    for di in 0..data.len() {
        result = dx;
        let si: u32 = data[di] as u32;
        let mut bx: u32 = data[((di as u32) + si + dx) as usize] as u32;
        bx = bx & 0xff;
        bx = RAND_TAB[bx as usize];
        dx = (std::num::Wrapping(bx) + std::num::Wrapping(dx)).0;
    }
    return (result & 0xffff) as u16;
}
const RAND_TAB: [u32; 704] = [
    0x67458B6B, 0xC6237B32, 0x69983C64, 0x73483366, 0x51DCB074, 0xFF5C4919, 0x4A94E82A, 0xEC585562,
    0x291F8E23, 0xCD7CE846, 0xBA581B3D, 0xABD77E50, 0xF241B12E, 0xFB1EB741, 0xE3A9E279, 0x46E14575,
    0x7C005F51, 0xC262D05B, 0x54082012, 0xF827B14D, 0x1B231602, 0xE8E9161F, 0xE7CD9011, 0x8D43EF66,
    0x760F0E14, 0x5A255233, 0x2EF99C10, 0x6372ED0D, 0x33C2DC7F, 0x9FD7EF1B, 0xC9C4A741, 0x9A07686B,
    0x66FB6A4E, 0x325DE425, 0x0D509B51, 0xB7D71B43, 0x31BA2D3F, 0x58E4837C, 0xA3307125, 0x5AD9BB62,
    0x25616C43, 0x5D898C62, 0x05B13A33, 0x17A31D72, 0x58A84324, 0xE95A1D2D, 0x5E846367, 0xD4A8A275,
    0xABBDED08, 0xB28C8379, 0xCDD05343, 0xC6E0030B, 0x9B769A18, 0xB49EE454, 0x5424F371, 0x1186A82C,
    0x0EC43608, 0x821D9002, 0x74F8953A, 0x41861308, 0x21F57F1E, 0x3DBD3D7C, 0xDC8D7B73, 0x87F0EA6C,
    0x701A2222, 0xE9DD1645, 0x3EC80630, 0xA1D44F61, 0x41C29A41, 0xE1F87755, 0xFCAD0B44, 0x67230705,
    0x3E820438, 0x015F4677, 0x7EC62477, 0x972A485C, 0xEAB96324, 0xDC4A885E, 0x6BD3EA51, 0x9677512D,
    0x8FD70B58, 0x38A43E15, 0x5C585538, 0x2A4EA670, 0xEC42236A, 0xB07C482A, 0x3BD44E1D, 0xFB065A72,
    0x329AD82C, 0xAFCCE457, 0x3C8D6D7A, 0x548F584B, 0xEC892254, 0x181BE96D, 0xDB7F4338, 0x5CA44476,
    0x02F9FF32, 0x1A484A68, 0xFE789457, 0x43BB9A74, 0xFB40C23D, 0xFA26A01B, 0xAADEA179, 0x3AC3C675,
    0xFB85E612, 0x29A5C670, 0xD1ED0E52, 0xE63F4A37, 0x05F04E4F, 0x3CC1F923, 0x7CB79B64, 0x94C75A27,
    0x75653839, 0xD80FF11C, 0xBE150118, 0x61A85B23, 0x898C3947, 0xF9E94F35, 0x5CAFB515, 0xBB261274,
    0xA8B6340D, 0x993C2310, 0x0FB66A3F, 0x95405761, 0xB1570C7E, 0xEB35AE77, 0xF1E49B57, 0xB3500C31,
    0x057EF85F, 0xEF5D302F, 0xF70BA725, 0x00BFBA1D, 0xE984D04A, 0xA1EA481F, 0x3A828113, 0xE50AB75D,
    0xCA8F0F10, 0x0B709065, 0xCB4A0115, 0xD07F5E5F, 0x48318A09, 0x47029D79, 0x6447B906, 0xBD96C242,
    0x1F128E16, 0x235DBA1E, 0x1E3F1E66, 0xA89EC75D, 0x1C470A54, 0x7BEED37B, 0x64C5D951, 0xC5FD3E61,
    0x142BF70B, 0x737B4411, 0x5A3E9642, 0xC582030A, 0x5EB1F208, 0x4B23321A, 0x79D30F3B, 0x632FEB68,
    0x3B816249, 0x70DFB660, 0x64EEA506, 0x24063314, 0x11CAFF7F, 0x9E70271A, 0x0911EA71, 0xDC590F10,
    0xAAE0B77F, 0xD45BEB06, 0xACD96D6F, 0xF2114209, 0x1B5E8800, 0x10212776, 0xAFA8044C, 0x3B701617,
    0x337EE114, 0xCDE72232, 0xE30EDE74, 0x50C5EB68, 0x48D6F62D, 0x47D4B746, 0x15C32A4A, 0x5C01EE39,
    0xBB4FFC57, 0x6F01C10C, 0x2284F143, 0x1901EF60, 0xBA24F326, 0x9B57017F, 0x7D30DA49, 0xF5A55570,
    0x0B37B85F, 0xE11E8050, 0x1AAC8804, 0x1C01B85F, 0x7F8FA76A, 0x23BD7276, 0xF85AC76F, 0x29705F6A,
    0xF8185E7D, 0xA434355F, 0x1B82A173, 0x1377E67D, 0xB5555C55, 0xCA2AA63F, 0x4EE7FC14, 0xE8D33D6A,
    0x9812C971, 0x32F6DA09, 0x38992953, 0xE0E8BF1F, 0x79CA9250, 0x4D5C541D, 0x3DEAAD59, 0x341A8F28,
    0xBC5D152A, 0x5F6E9F1D, 0x4E1B7E09, 0x77820851, 0xFAC5A01C, 0xCB4B5853, 0x6C285E41, 0x05FD587C,
    0xAC6AD823, 0x86D4E645, 0x21FE105C, 0x2BFA7F0E, 0xAA91593C, 0x1A59D84B, 0x556ADF78, 0xA2AAB739,
    0xBE8D0D2B, 0x70EC806C, 0xB5219E37, 0x73E36900, 0x3B17272C, 0x04099B4C, 0x5CB7A76A, 0xD329F01D,
    0x36FF7556, 0x9450D13D, 0xB312B03D, 0xAFC90827, 0xE2AC255B, 0xF0FC5D17, 0xE4E3974F, 0x9E0A3B05,
    0x4F6BFD34, 0x32FF1559, 0x158D4356, 0x49319E51, 0xFD4A6E2C, 0x82B5A117, 0x4E2EF74D, 0xA9B54650,
    0x088A885D, 0x702C082A, 0xD4AFC65E, 0xB21BE219, 0x8A85E075, 0x291AA657, 0x54C69953, 0x4813EE20,
    0x9A062744, 0x0AE8370B, 0xBCF65721, 0xD51D4E70, 0x0EF1D257, 0x18AEFF0B, 0xA8473E0E, 0x44F0482E,
    0xACFED049, 0x5B5AEE4B, 0xF3B95155, 0x8EABF624, 0x4C574C63, 0xD79DE924, 0x2DB6312A, 0x9BC24918,
    0x099DFF7D, 0x42437500, 0xE5F3E769, 0x06E86D2A, 0xC4F81618, 0x3322DF37, 0xAF9DB47A, 0xCD829F75,
    0xA34EE761, 0x844D7B59, 0x7F9E810F, 0x2DD4C757, 0xAD672131, 0xD4641B63, 0x76E7B578, 0x476E4875,
    0xDE4C536E, 0x32DE0D1A, 0x1C8C9665, 0xEC3D2646, 0x4A8C0D26, 0xC4D3D473, 0x302E6F74, 0xF68ADE6F,
    0x202EC33F, 0x23E8C049, 0x8536D514, 0x6C850F23, 0xFB85AA6E, 0xB2EC063F, 0x0748593B, 0x0423AA6C,
    0xF42F7C3F, 0xEC3B4125, 0x0B0B1817, 0xB9289357, 0x205E205D, 0xBAA8CC11, 0x86AB324D, 0xC3AC073F,
    0x3EF6476B, 0x054AB45C, 0xF180CF16, 0xEC5D691C, 0xD9AECF3F, 0x6768850F, 0x33CCB111, 0xB7FB222E,
    0x99469329, 0x50584877, 0xA3394974, 0xE3D2A04F, 0x142C1D6B, 0xD367B868, 0xD95D7F3F, 0x345AE02A,
    0xF74F7932, 0x5E945454, 0xA0DFEF4D, 0xF2D52321, 0x10815B13, 0xA8274909, 0xF6F8CD0D, 0x05B1D752,
    0x94638A2E, 0x0104E624, 0xBED96A2A, 0xB4C1AA0B, 0xBCACB236, 0x44859D77, 0x786EB24A, 0xFAA2FA21,
    0x49CF5154, 0x69EF8161, 0xE600643E, 0x237E2114, 0xD0570771, 0x1ACD1550, 0xDA794442, 0x699E9A1A,
    0x6A255E47, 0x7EB38D36, 0x4C713B6A, 0x7E517B32, 0x511B461F, 0x25CFBA29, 0xB3AB5B5D, 0x486BBF51,
    0x84630F7E, 0x538B4B2B, 0x3A41E372, 0x94E46A11, 0xFBB29434, 0x313AB100, 0x99954264, 0x90161F63,
    0x323E9725, 0x576FAD0E, 0x44D8C96E, 0xEEEA495C, 0x9BF44A06, 0xBC467C39, 0xE98D447E, 0xE5C39C5A,
    0x2536FE1A, 0xCF8EA83C, 0x0842BE6E, 0xF58D050C, 0xE95BBE0C, 0xE2BB0231, 0x5E2CA026, 0x53811C54,
    0x606F9067, 0xAA9DDB10, 0xD2D29706, 0xB28AD606, 0xD06C963A, 0x857EF363, 0xFAF59558, 0x54D0A538,
    0xD8093F0F, 0x3537794B, 0xE8B4104A, 0xD4BCD343, 0x66712A4C, 0x824A532E, 0x64D3F226, 0x98AFC171,
    0xD9B9003D, 0xA8ABBC15, 0x879A0B4E, 0x75AE4B43, 0x65F2384F, 0x7028504C, 0x5A72E81D, 0x8A28376A,
    0x3FB7F808, 0x62B4A60C, 0x80B63C76, 0x2913B715, 0x4470A93D, 0xDEE2DC1C, 0x7C94D369, 0xA5DF3925,
    0x8980B82D, 0x4E676B70, 0x576A102C, 0x59ED4E68, 0xD3E55E54, 0x5160A604, 0xADBDF420, 0xACEF9D63,
    0x86971F50, 0x9572056B, 0x80AC7127, 0xEC084A1C, 0x17BD5819, 0xE47F644E, 0x85B80B0E, 0xF1765956,
    0x8C2B2164, 0x0C53175C, 0x6625A519, 0xF11D5A33, 0x7C7B6728, 0xC0978D37, 0x7C46911D, 0xBB326031,
    0x224C3444, 0xFCFCCD13, 0xE4451747, 0x66BCDD01, 0xDADFAA30, 0x61DAEA30, 0x0B9C1727, 0x6360635E,
    0xAF415621, 0x62062853, 0xBC4DB246, 0x8327B575, 0xB466CE57, 0x690BA767, 0x2F175359, 0x3AFEED27,
    0xFF7DAC52, 0xAFC3C400, 0x27073844, 0x163B056C, 0x9343294F, 0xACBF4352, 0x07B25E42, 0x1F6F4A33,
    0xB8125B2E, 0x6DD7035C, 0x118DA466, 0x348EC256, 0x2D6F9113, 0x8DD33504, 0xEFC02208, 0x4FBBC557,
    0x89D00318, 0xD4063A4F, 0xB677A359, 0x63B0AE48, 0x35E12400, 0xC113BB00, 0xC7101227, 0xE4227B21,
    0x241AE353, 0x835EC46D, 0x674A3017, 0xD880B12B, 0xED696B55, 0x96618370, 0x127F9F53, 0xECE71728,
    0x45254871, 0x3986D717, 0x02231D14, 0xD8687140, 0xE2FFFFFF, 0x00000000, 0x1E000000, 0x3C000000,
    0x5A000000, 0x82000000, 0x00000000, 0x00000000, 0x00000000, 0x0F000000, 0x1E000000, 0x3C000000,
    0x5A000000, 0x78000000, 0x96000000, 0xB4000000, 0xD2000000, 0xF0000000, 0x0E010000, 0x2C010000,
    0x00000000, 0x0A000000, 0x14000000, 0x28000000, 0x3C000000, 0x50000000, 0x64000000, 0x78000000,
    0x8C000000, 0xA0000000, 0xB4000000, 0xC8000000, 0x00000000, 0x0A000000, 0x14000000, 0x1E000000,
    0x28000000, 0x3C000000, 0x50000000, 0x64000000, 0x8C000000, 0xA0000000, 0x00000000, 0x00000000,
    0x01000000, 0x01000000, 0x00000000, 0x01000000, 0x01000000, 0x00000000, 0x00000000, 0x00000000,
    0x39010000, 0xC8020000, 0xC9020000, 0xCB020000, 0xCC020000, 0xCD020000, 0x00000000, 0x00000000,
    0x3A010000, 0xCE020000, 0xED030000, 0xEE030000, 0x45040000, 0x00000000, 0x00000000, 0x00000000,
    0x01000000, 0x00000000, 0x01000000, 0x00000000, 0x01000000, 0x00000000, 0x00000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x10000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x06000000, 0x12000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x05000000, 0x16000000, 0x0D000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x08000000, 0x18000000, 0x09000000, 0x19000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x04000000, 0x13000000, 0x06000000, 0x12000000, 0x17000000, 0x00000000, 0x00000000, 0x00000000,
    0x04000000, 0x13000000, 0x06000000, 0x12000000, 0x17000000, 0x0F000000, 0x00000000, 0x00000000,
    0x04000000, 0x13000000, 0x06000000, 0x12000000, 0x17000000, 0x0F000000, 0x0C000000, 0x00000000,
    0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x1A000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x11000000, 0x1C000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x0E000000, 0x15000000, 0x1D000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x08000000, 0x09000000, 0x18000000, 0x19000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000,
    0x0E000000, 0x13000000, 0x18000000, 0x0F000000, 0x16000000, 0x00000000, 0x00000000, 0x00000000,
    0x0E000000, 0x11000000, 0x18000000, 0x0D000000, 0x16000000, 0x1A000000, 0x00000000, 0x00000000,
    0x0E000000, 0x11000000, 0x18000000, 0x0D000000, 0x16000000, 0x1A000000, 0x0B000000, 0x00000000,
];
